<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรแกรมคำนวณผลประโยชน์โปรโมชั่น ยิ้มรับดอกเบี้ยสูง</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-light: #e8f0fe;
            --secondary: #34a853;
            --accent: #fbbc05;
            --text: #202124;
            --text-light: #5f6368;
            --background: #ffffff;
            --card-bg: #f8f9fa;
            --border: #dadce0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
        }

        .welcome-text {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 2rem;
            transform: translateY(-50px);
            opacity: 0;
            animation: slideDown 1s ease forwards;
        }

        .promo-text {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 3rem;
            overflow: hidden;
        }

        .promo-left {
            display: inline-block;
            transform: translateX(-100%);
            animation: slideInLeft 1s ease 0.5s forwards;
        }

        .promo-right {
            display: inline-block;
            transform: translateX(100%);
            animation: slideInRight 1s ease 0.5s forwards;
        }

        .start-btn {
            background: linear-gradient(135deg, var(--primary), #0d47a1);
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(26, 115, 232, 0.3);
            transform: translateY(50px);
            opacity: 0;
            animation: slideUp 1s ease 1s forwards;
            transition: all 0.3s ease;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
        }

        .progress-container {
            width: 80%;
            max-width: 400px;
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin-top: 2rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--primary);
            border-radius: 3px;
            animation: grow 2s ease-in-out forwards;
        }

        .main-content {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: 600;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-light);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
            outline: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #0d47a1;
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-outline:hover {
            background-color: var(--primary-light);
        }

        .nav-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .result-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
        }

        .result-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-light);
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .result-subvalue {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background-color: var(--primary-light);
            font-weight: 600;
            color: var(--text);
        }

        .data-table tr:hover {
            background-color: rgba(26, 115, 232, 0.05);
        }

        .summary-box {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .summary-item {
            text-align: center;
            flex: 1;
        }

        .summary-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
            margin-left: auto;
        }

        .credit {
            text-align: center;
            margin-top: 30px;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .error-message {
            color: #d93025;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .expand-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-weight: 500;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hidden-rows {
            display: none;
        }

        @keyframes slideDown {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideInLeft {
            to {
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            to {
                transform: translateX(0);
            }
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes grow {
            to {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .welcome-text {
                font-size: 2rem;
            }
            
            .promo-text {
                font-size: 1.5rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .summary-box {
                flex-direction: column;
                gap: 15px;
            }
            
            .summary-item {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <!-- หน้า Loading -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="welcome-text">Welcome</div>
            <div class="promo-text">
                <span class="promo-left">RH5 PROMO</span>
                <span class="promo-right">TION Cal.</span>
            </div>
            <button class="start-btn" id="startBtn">เริ่ม!</button>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- เนื้อหาหลัก -->
    <div class="main-content" id="mainContent">
        <div class="header">
            <div class="logo">โปรแกรมคำนวณผลประโยชน์</div>
            <div class="user-info">
                <div class="user-avatar">SR</div>
                <div>Sajibur Rahman</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">
                <i class="fas fa-calculator"></i>
                ข้อมูลการคำนวณ
            </div>
            
            <div class="form-group">
                <label class="form-label">เลือกแบบประกัน</label>
                <select class="form-control" id="insurancePlan">
                    <option value="">-- เลือกแบบประกัน --</option>
                    <option value="ttb_ultimate_legacy_99_3">ทีทีบี อัลติเมท เลกาซี 99/3</option>
                    <option value="ttb_global_index_principal_protect_15_5">ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5</option>
                    <option value="ttb_global_index_principal_protect_15_5_plus">ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5 พลัส</option>
                    <option value="ttb_global_index_principal_protect_15_5_max">ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5 แม็กซ์</option>
                    <option value="ttb_wealth_transfer_99_5">ทีทีบี ส่งต่อความมั่งคั่ง 99/5</option>
                    <option value="ttb_happy_life_protect_99_10">ทีทีบี แฮปปี้ ไลฟ์ โพรเทค 99/10</option>
                    <option value="ttb_money_saver_14_6">ทีทีบี มันนี่ เซฟเวอร์ 14/6</option>
                    <option value="ttb_money_saver_15_6">ทีทีบี มันนี่ เซฟเวอร์ 15/6</option>
                    <option value="ttb_smart_bonus_10_5">ทีทีบี สมาร์ท โบนัส 10/5</option>
                    <option value="ttb_premium_saver_11_3">ทีทีบี พรีเมียม เซฟเวอร์ 11/3</option>
                    <option value="ttb_the_treasure_plan_2">ทีทีบี เดอะ เทรเชอร์ แผน 2</option>
                    <option value="ttb_the_treasure_plus">ทีทีบี เดอะ เทรเชอร์ พลัส</option>
                    <option value="ttb_the_treasure_extra">ทีทีบี เดอะ เทรเชอร์ เอ็กซ์ตร้า</option>
                </select>
                <div class="error-message" id="planError"></div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="form-label">อายุผู้เอาประกัน</label>
                        <input type="number" class="form-control" id="age" min="1" max="99">
                        <div class="error-message" id="ageError"></div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="form-label">ทุนประกัน (บาท)</label>
                        <input type="number" class="form-control" id="sumAssured" min="0">
                        <div class="error-message" id="sumAssuredError"></div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="form-label">เบี้ยประกัน (บาท)</label>
                        <input type="number" class="form-control" id="premium" min="50000">
                        <div class="error-message" id="premiumError"></div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">โปรโมชั่นเงินฝาก</label>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">เลือกระยะเวลาฝาก</label>
                            <select class="form-control" id="depositTerm">
                                <option value="">-- เลือกระยะเวลา --</option>
                                <option value="36">ฝากประจำ 36 เดือน (ดอกเบี้ย 1.50%)</option>
                                <option value="6">ฝากประจำ 6 เดือน (ดอกเบี้ย 1.25%)</option>
                            </select>
                            <div class="error-message" id="termError"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">จำนวนเท่าของเงินฝาก (สูงสุด: <span id="maxMultiplier">0</span> เท่า)</label>
                            <input type="number" class="form-control" id="multiplier" min="1" max="20">
                            <div class="error-message" id="multiplierError"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <button class="btn-primary" id="calculateBtn">คำนวณผลประโยชน์</button>
                <button class="btn-outline export-btn" id="exportPdfBtn">
                    <i class="fas fa-file-pdf"></i> Export PDF
                </button>
            </div>
        </div>

        <!-- แท็บผลลัพธ์ -->
        <div class="card" id="resultsCard" style="display: none;">
            <div class="nav-tabs" id="resultsTabs">
                <div class="nav-tab active" data-tab="summary">สรุปผลตอบแทน</div>
                <div class="nav-tab" data-tab="insurance">ผลประโยชน์ประกันฯ</div>
                <div class="nav-tab" data-tab="deposit">ผลประโยชน์เงินฝาก</div>
                <div class="nav-tab" data-tab="calculation">วิธีคำนวณ</div>
            </div>
            
            <!-- แท็บสรุปผลตอบแทน -->
            <div class="tab-content active" id="summaryTab">
                <div class="row">
                    <div class="col-md-6">
                        <div class="result-card">
                            <div class="result-title">ผลประโยชน์ของประกัน</div>
                            <div class="result-value" id="insuranceBenefit">0 บาท</div>
                            <div class="result-subvalue" id="insuranceIrr">IRR: 0%</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card">
                            <div class="result-title">ผลประโยชน์เงินฝาก</div>
                            <div class="result-value" id="depositBenefit">0 บาท</div>
                            <div class="result-subvalue" id="depositIrr">IRR: 0%</div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="result-card">
                            <div class="result-title">รวมผลประโยชน์</div>
                            <div class="result-value" id="totalBenefit">0 บาท</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card">
                            <div class="result-title">ผลประโยชน์สุทธิ</div>
                            <div class="result-value" id="netBenefit">0 บาท</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- แท็บผลประโยชน์ประกัน -->
            <div class="tab-content" id="insuranceTab">
                <div class="table-container">
                    <table class="data-table" id="insuranceTable">
                        <thead>
                            <tr>
                                <th>ปีกรมธรรม์</th>
                                <th>เบี้ยประกัน</th>
                                <th>เบี้ยประกันสะสม</th>
                                <th>เงินระหว่างสัญญา</th>
                                <th>เงินครบสัญญา</th>
                            </tr>
                        </thead>
                        <tbody id="insuranceTableBody">
                            <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                        </tbody>
                    </table>
                </div>
                <button class="expand-btn" id="expandInsuranceBtn">
                    <i class="fas fa-chevron-down"></i> แสดงทั้งหมด
                </button>
                
                <div class="summary-box">
                    <div class="summary-item">
                        <div class="summary-label">เบี้ยประกันที่ชำระ</div>
                        <div class="summary-value" id="totalPremium">0 บาท</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">เงินประโยชน์ตามสัญญา</div>
                        <div class="summary-value" id="totalInsuranceBenefit">0 บาท</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ผลประโยชน์สุทธิ</div>
                        <div class="summary-value" id="netInsuranceBenefit">0 บาท</div>
                    </div>
                </div>
            </div>
            
            <!-- แท็บผลประโยชน์เงินฝาก -->
            <div class="tab-content" id="depositTab">
                <div class="table-container">
                    <table class="data-table" id="depositTable">
                        <thead>
                            <tr>
                                <th>ปี</th>
                                <th>เงินต้น</th>
                                <th>ดอกเบี้ยก่อนภาษี</th>
                                <th>ดอกเบี้ยหลังภาษี</th>
                            </tr>
                        </thead>
                        <tbody id="depositTableBody">
                            <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="summary-box">
                    <div class="summary-item">
                        <div class="summary-label">เงินต้น</div>
                        <div class="summary-value" id="totalDeposit">0 บาท</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ดอกเบี้ยก่อนหักภาษี</div>
                        <div class="summary-value" id="totalInterestBeforeTax">0 บาท</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ดอกเบี้ยหลังเสียภาษี</div>
                        <div class="summary-value" id="totalInterestAfterTax">0 บาท</div>
                    </div>
                </div>
            </div>
            
            <!-- แท็บวิธีคำนวณ -->
            <div class="tab-content" id="calculationTab">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-lock"></i>
                        วิธีการคำนวณ IRR
                    </div>
                    <p>ส่วนนี้จำเป็นต้องใช้รหัสผ่านเพื่อเข้าถึง</p>
                    <div class="form-group">
                        <label class="form-label">รหัสผ่าน</label>
                        <input type="password" class="form-control" id="passwordInput">
                        <div class="error-message" id="passwordError"></div>
                    </div>
                    <button class="btn-primary" id="unlockCalculationBtn">ปลดล็อค</button>
                    
                    <div id="calculationContent" style="display: none; margin-top: 20px;">
                        <h5>การคำนวณ IRR สำหรับประกันชีวิต</h5>
                        <p>IRR (Internal Rate of Return) คืออัตราผลตอบแทนภายในที่ทำให้มูลค่าปัจจุบันของกระแสเงินสดเข้าเท่ากับมูลค่าปัจจุบันของกระแสเงินสดออก</p>
                        
                        <h6>สูตรการคำนวณ:</h6>
                        <p>Σ [CF<sub>t</sub> / (1 + IRR)<sup>t</sup>] = 0</p>
                        
                        <h6>กระแสเงินสดสำหรับประกันชีวิต:</h6>
                        <ul>
                            <li>ปีที่ 0: -เบี้ยประกัน</li>
                            <li>ปีที่ 1 ถึงปีที่ n-1: เงินคืนระหว่างสัญญา (ถ้ามี)</li>
                            <li>ปีที่ n: เงินครบสัญญา</li>
                        </ul>
                        
                        <h5>การคำนวณ IRR สำหรับเงินฝาก</h5>
                        <p>ใช้สูตรเดียวกันกับการคำนวณ IRR สำหรับประกันชีวิต แต่กระแสเงินสดแตกต่างกัน</p>
                        
                        <h6>กระแสเงินสดสำหรับเงินฝาก:</h6>
                        <ul>
                            <li>ปีที่ 0: -เงินต้น</li>
                            <li>ปีที่ 1 ถึงปีที่ n-1: ดอกเบี้ยที่ได้รับ (หลังหักภาษี)</li>
                            <li>ปีที่ n: ดอกเบี้ย + เงินต้นคืน</li>
                        </ul>
                        
                        <button class="btn-outline" id="verifyCalculationBtn">
                            <i class="fas fa-check-circle"></i> ตรวจสอบการคำนวณ
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="credit">
            Produce by : Training Specialist [PRU ACADEMY]
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // ข้อมูลผลิตภัณฑ์ประกัน
        const insurancePlans = {
            "ttb_ultimate_legacy_99_3": {
                name: "ทีทีบี อัลติเมท เลกาซี 99/3",
                minAge: 0, // 1 เดือน
                maxAge: 75,
                minSumAssured: 10000000,
                maxSumAssured: null, // ไม่จำกัด
                premiumMin: 50000,
                term: 99,
                hasMidTerm: false,
                midTermRate: 0,
                midTermFrequency: 0,
                maturityRate: 1, // 100% ของทุนประกันภัย
                group: 1
            },
            "ttb_global_index_principal_protect_15_5": {
                name: "ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5",
                minAge: 0, // 1 เดือน
                maxAge: 70,
                minSumAssured: 50000,
                maxSumAssured: null, // ไม่จำกัด
                premiumMin: 50000,
                term: 15,
                hasMidTerm: true,
                midTermRate: 0.05, // 5% ของทุนประกันภัย
                midTermFrequency: 2, // ทุก 2 ปี
                maturityRate: 5, // 500% ของทุนประกันภัย
                group: 1
            },
            // เพิ่มข้อมูลผลิตภัณฑ์อื่นๆ ตามที่ระบุ
            "ttb_money_saver_15_6": {
                name: "ทีทีบี มันนี่ เซฟเวอร์ 15/6",
                minAge: 0, // 1 เดือน
                maxAge: 70,
                minSumAssured: 100000,
                maxSumAssured: null, // ไม่จำกัด
                premiumMin: 50000,
                term: 15,
                hasMidTerm: true,
                midTermRate: 0.025, // 2.5% ของทุนประกันภัย
                midTermFrequency: 1, // ทุกปี
                maturityRate: 1.5, // 150% ของทุนประกันภัย
                group: 2
            }
            // สามารถเพิ่มผลิตภัณฑ์อื่นๆ ตามที่ระบุในโจทย์ได้ที่นี่
        };

        // ข้อมูลโปรโมชั่น
        const promotionRules = {
            group1: {
                td36: { multiplier: 20, interest: 0.015 },
                td6: { multiplier: 15, interest: 0.0125 }
            },
            group2: {
                td36: { multiplier: 10, interest: 0.015 },
                td6: { multiplier: 7.5, interest: 0.0125 }
            }
        };

        // DOM Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const mainContent = document.getElementById('mainContent');
        const startBtn = document.getElementById('startBtn');
        const calculateBtn = document.getElementById('calculateBtn');
        const exportPdfBtn = document.getElementById('exportPdfBtn');
        const resultsCard = document.getElementById('resultsCard');
        const resultsTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const unlockCalculationBtn = document.getElementById('unlockCalculationBtn');
        const calculationContent = document.getElementById('calculationContent');
        const verifyCalculationBtn = document.getElementById('verifyCalculationBtn');
        const expandInsuranceBtn = document.getElementById('expandInsuranceBtn');

        // ฟังก์ชันเริ่มต้น
        document.addEventListener('DOMContentLoaded', function() {
            // เริ่มต้นแอปพลิเคชัน
            startBtn.addEventListener('click', function() {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    mainContent.style.display = 'block';
                }, 500);
            });

            // ตั้งค่า Event Listeners
            setupEventListeners();
        });

        // ตั้งค่า Event Listeners
        function setupEventListeners() {
            // เมื่อเลือกแบบประกัน
            document.getElementById('insurancePlan').addEventListener('change', function() {
                updateMaxMultiplier();
                validateForm();
            });

            // เมื่อเลือกระยะเวลาฝาก
            document.getElementById('depositTerm').addEventListener('change', function() {
                updateMaxMultiplier();
                validateForm();
            });

            // เมื่อกรอกเบี้ยประกัน
            document.getElementById('premium').addEventListener('input', function() {
                updateMaxMultiplier();
                validateForm();
            });

            // เมื่อกดคำนวณ
            calculateBtn.addEventListener('click', function() {
                if (validateForm()) {
                    calculateBenefits();
                    resultsCard.style.display = 'block';
                }
            });

            // เมื่อกด Export PDF
            exportPdfBtn.addEventListener('click', function() {
                exportToPdf();
            });

            // เมื่อเปลี่ยนแท็บ
            resultsTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // อัพเดทแท็บที่ active
                    resultsTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // แสดงเนื้อหาแท็บที่เลือก
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}Tab`) {
                            content.classList.add('active');
                        }
                    });
                });
            });

            // เมื่อกดปลดล็อคการคำนวณ
            unlockCalculationBtn.addEventListener('click', function() {
                const password = document.getElementById('passwordInput').value;
                if (password === '0229') {
                    calculationContent.style.display = 'block';
                    document.getElementById('passwordError').style.display = 'none';
                } else {
                    document.getElementById('passwordError').textContent = 'รหัสผ่านไม่ถูกต้อง';
                    document.getElementById('passwordError').style.display = 'block';
                }
            });

            // เมื่อกดตรวจสอบการคำนวณ
            verifyCalculationBtn.addEventListener('click', function() {
                verifyCalculation();
            });

            // เมื่อกดขยายตารางประกัน
            expandInsuranceBtn.addEventListener('click', function() {
                toggleInsuranceTable();
            });
        }

        // อัพเดทจำนวนเท่าสูงสุดตามสิทธิ์
        function updateMaxMultiplier() {
            const planSelect = document.getElementById('insurancePlan');
            const depositTerm = document.getElementById('depositTerm').value;
            const premium = parseFloat(document.getElementById('premium').value) || 0;
            
            if (planSelect.value && depositTerm) {
                const plan = insurancePlans[planSelect.value];
                const group = plan.group;
                const termType = depositTerm === '36' ? 'td36' : 'td6';
                const maxMultiplier = promotionRules[`group${group}`][termType].multiplier;
                
                document.getElementById('maxMultiplier').textContent = maxMultiplier;
                document.getElementById('multiplier').setAttribute('max', maxMultiplier);
                
                // อัพเดทข้อความแนะนำ
                const multiplierInput = document.getElementById('multiplier');
                if (multiplierInput.value > maxMultiplier) {
                    multiplierInput.value = maxMultiplier;
                }
            }
        }

        // ตรวจสอบความถูกต้องของฟอร์ม
        function validateForm() {
            let isValid = true;
            const planSelect = document.getElementById('insurancePlan');
            const ageInput = document.getElementById('age');
            const sumAssuredInput = document.getElementById('sumAssured');
            const premiumInput = document.getElementById('premium');
            const depositTermSelect = document.getElementById('depositTerm');
            const multiplierInput = document.getElementById('multiplier');
            
            // รีเซ็ต error messages
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
            });
            
            // ตรวจสอบแบบประกัน
            if (!planSelect.value) {
                document.getElementById('planError').textContent = 'กรุณาเลือกแบบประกัน';
                document.getElementById('planError').style.display = 'block';
                isValid = false;
            }
            
            // ตรวจสอบอายุ
            const age = parseInt(ageInput.value);
            if (isNaN(age) || age < 1 || age > 99) {
                document.getElementById('ageError').textContent = 'กรุณากรอกอายุระหว่าง 1-99 ปี';
                document.getElementById('ageError').style.display = 'block';
                isValid = false;
            } else if (planSelect.value) {
                const plan = insurancePlans[planSelect.value];
                if (age < plan.minAge || age > plan.maxAge) {
                    document.getElementById('ageError').textContent = `อายุต้องอยู่ระหว่าง ${plan.minAge} - ${plan.maxAge} ปี สำหรับแบบประกันนี้`;
                    document.getElementById('ageError').style.display = 'block';
                    isValid = false;
                }
            }
            
            // ตรวจสอบทุนประกัน
            const sumAssured = parseFloat(sumAssuredInput.value);
            if (isNaN(sumAssured) || sumAssured <= 0) {
                document.getElementById('sumAssuredError').textContent = 'กรุณากรอกทุนประกัน';
                document.getElementById('sumAssuredError').style.display = 'block';
                isValid = false;
            } else if (planSelect.value) {
                const plan = insurancePlans[planSelect.value];
                if (sumAssured < plan.minSumAssured) {
                    document.getElementById('sumAssuredError').textContent = `ทุนประกันขั้นต่ำ ${plan.minSumAssured.toLocaleString()} บาท สำหรับแบบประกันนี้`;
                    document.getElementById('sumAssuredError').style.display = 'block';
                    isValid = false;
                }
            }
            
            // ตรวจสอบเบี้ยประกัน
            const premium = parseFloat(premiumInput.value);
            if (isNaN(premium) || premium < 50000) {
                document.getElementById('premiumError').textContent = 'เบี้ยประกันขั้นต่ำ 50,000 บาท';
                document.getElementById('premiumError').style.display = 'block';
                isValid = false;
            }
            
            // ตรวจสอบระยะเวลาฝาก
            if (!depositTermSelect.value) {
                document.getElementById('termError').textContent = 'กรุณาเลือกระยะเวลาฝาก';
                document.getElementById('termError').style.display = 'block';
                isValid = false;
            }
            
            // ตรวจสอบจำนวนเท่า
            const multiplier = parseFloat(multiplierInput.value);
            const maxMultiplier = parseFloat(document.getElementById('maxMultiplier').textContent);
            if (isNaN(multiplier) || multiplier < 1) {
                document.getElementById('multiplierError').textContent = 'กรุณากรอกจำนวนเท่า';
                document.getElementById('multiplierError').style.display = 'block';
                isValid = false;
            } else if (multiplier > maxMultiplier) {
                document.getElementById('multiplierError').textContent = `จำนวนเท่าสูงสุดคือ ${maxMultiplier} เท่า`;
                document.getElementById('multiplierError').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }

        // คำนวณผลประโยชน์
        function calculateBenefits() {
            // รับค่าจากฟอร์ม
            const plan = insurancePlans[document.getElementById('insurancePlan').value];
            const age = parseInt(document.getElementById('age').value);
            const sumAssured = parseFloat(document.getElementById('sumAssured').value);
            const premium = parseFloat(document.getElementById('premium').value);
            const depositTerm = parseInt(document.getElementById('depositTerm').value);
            const multiplier = parseFloat(document.getElementById('multiplier').value);
            
            // คำนวณเงินฝาก
            const depositAmount = premium * multiplier;
            const depositInterestRate = promotionRules[`group${plan.group}`][depositTerm === 36 ? 'td36' : 'td6'].interest;
            
            // คำนวณผลประโยชน์ประกัน
            calculateInsuranceBenefits(plan, sumAssured, premium, age);
            
            // คำนวณผลประโยชน์เงินฝาก
            calculateDepositBenefits(depositAmount, depositInterestRate, depositTerm);
            
            // คำนวณและแสดงผลลัพธ์สรุป
            updateSummaryResults();
        }

        // คำนวณผลประโยชน์ประกัน
        function calculateInsuranceBenefits(plan, sumAssured, premium, age) {
            const tableBody = document.getElementById('insuranceTableBody');
            tableBody.innerHTML = '';
            
            let totalPremium = 0;
            let totalBenefit = 0;
            let cumulativePremium = 0;
            
            // กำหนดปีสิ้นสุดสัญญา
            const endYear = Math.min(plan.term, 99 - age);
            
            for (let year = 1; year <= endYear; year++) {
                const row = document.createElement('tr');
                
                // ปีกรมธรรม์
                const yearCell = document.createElement('td');
                yearCell.textContent = year;
                row.appendChild(yearCell);
                
                // เบี้ยประกัน (จ่ายเฉพาะปีแรก)
                const premiumCell = document.createElement('td');
                if (year === 1) {
                    premiumCell.textContent = premium.toLocaleString();
                    totalPremium += premium;
                    cumulativePremium += premium;
                } else {
                    premiumCell.textContent = '-';
                }
                row.appendChild(premiumCell);
                
                // เบี้ยประกันสะสม
                const cumulativeCell = document.createElement('td');
                cumulativeCell.textContent = cumulativePremium.toLocaleString();
                row.appendChild(cumulativeCell);
                
                // เงินระหว่างสัญญา
                const midTermCell = document.createElement('td');
                let midTermBenefit = 0;
                if (plan.hasMidTerm && year % plan.midTermFrequency === 0 && year < endYear) {
                    midTermBenefit = sumAssured * plan.midTermRate;
                    midTermCell.textContent = midTermBenefit.toLocaleString();
                    totalBenefit += midTermBenefit;
                } else {
                    midTermCell.textContent = '-';
                }
                row.appendChild(midTermCell);
                
                // เงินครบสัญญา
                const maturityCell = document.createElement('td');
                let maturityBenefit = 0;
                if (year === endYear) {
                    maturityBenefit = sumAssured * plan.maturityRate;
                    maturityCell.textContent = maturityBenefit.toLocaleString();
                    totalBenefit += maturityBenefit;
                } else {
                    maturityCell.textContent = '-';
                }
                row.appendChild(maturityCell);
                
                tableBody.appendChild(row);
                
                // ซ่อนแถวถ้ามีมากกว่า 10 แถวและไม่ใช่ 5 แถวแรกหรือ 5 แถวสุดท้าย
                if (endYear > 10 && year > 5 && year <= endYear - 5) {
                    row.classList.add('hidden-rows');
                }
            }
            
            // อัพเดทผลรวม
            document.getElementById('totalPremium').textContent = totalPremium.toLocaleString() + ' บาท';
            document.getElementById('totalInsuranceBenefit').textContent = totalBenefit.toLocaleString() + ' บาท';
            document.getElementById('netInsuranceBenefit').textContent = (totalBenefit - totalPremium).toLocaleString() + ' บาท';
            
            // คำนวณ IRR (แบบง่าย)
            const insuranceIrr = calculateSimpleIRR(totalPremium, totalBenefit, endYear);
            document.getElementById('insuranceBenefit').textContent = totalBenefit.toLocaleString() + ' บาท';
            document.getElementById('insuranceIrr').textContent = `IRR: ${insuranceIrr.toFixed(2)}%`;
            
            return {
                totalPremium,
                totalBenefit,
                netBenefit: totalBenefit - totalPremium,
                irr: insuranceIrr
            };
        }

        // คำนวณผลประโยชน์เงินฝาก
        function calculateDepositBenefits(depositAmount, interestRate, termYears) {
            const tableBody = document.getElementById('depositTableBody');
            tableBody.innerHTML = '';
            
            let totalInterestBeforeTax = 0;
            let totalInterestAfterTax = 0;
            let currentAmount = depositAmount;
            
            for (let year = 1; year <= termYears; year++) {
                const row = document.createElement('tr');
                
                // ปี
                const yearCell = document.createElement('td');
                yearCell.textContent = year;
                row.appendChild(yearCell);
                
                // เงินต้น
                const principalCell = document.createElement('td');
                principalCell.textContent = depositAmount.toLocaleString();
                row.appendChild(principalCell);
                
                // ดอกเบี้ยก่อนภาษี
                const interestBeforeTax = currentAmount * interestRate;
                const interestBeforeTaxCell = document.createElement('td');
                interestBeforeTaxCell.textContent = interestBeforeTax.toLocaleString(undefined, {maximumFractionDigits: 2});
                row.appendChild(interestBeforeTaxCell);
                
                totalInterestBeforeTax += interestBeforeTax;
                
                // ดอกเบี้ยหลังภาษี
                let tax = 0;
                if (interestBeforeTax > 20000) {
                    tax = (interestBeforeTax - 20000) * 0.15;
                }
                const interestAfterTax = interestBeforeTax - tax;
                const interestAfterTaxCell = document.createElement('td');
                interestAfterTaxCell.textContent = interestAfterTax.toLocaleString(undefined, {maximumFractionDigits: 2});
                row.appendChild(interestAfterTaxCell);
                
                totalInterestAfterTax += interestAfterTax;
                currentAmount += interestAfterTax;
                
                tableBody.appendChild(row);
            }
            
            // อัพเดทผลรวม
            document.getElementById('totalDeposit').textContent = depositAmount.toLocaleString() + ' บาท';
            document.getElementById('totalInterestBeforeTax').textContent = totalInterestBeforeTax.toLocaleString(undefined, {maximumFractionDigits: 2}) + ' บาท';
            document.getElementById('totalInterestAfterTax').textContent = totalInterestAfterTax.toLocaleString(undefined, {maximumFractionDigits: 2}) + ' บาท';
            
            // คำนวณ IRR (แบบง่าย)
            const depositIrr = calculateSimpleIRR(depositAmount, depositAmount + totalInterestAfterTax, termYears);
            document.getElementById('depositBenefit').textContent = (depositAmount + totalInterestAfterTax).toLocaleString(undefined, {maximumFractionDigits: 2}) + ' บาท';
            document.getElementById('depositIrr').textContent = `IRR: ${depositIrr.toFixed(2)}%`;
            
            return {
                totalDeposit: depositAmount,
                totalInterestBeforeTax,
                totalInterestAfterTax,
                totalBenefit: depositAmount + totalInterestAfterTax,
                irr: depositIrr
            };
        }

        // อัพเดทผลลัพธ์สรุป
        function updateSummaryResults() {
            const insuranceBenefit = parseFloat(document.getElementById('insuranceBenefit').textContent.replace(/,/g, ''));
            const depositBenefit = parseFloat(document.getElementById('depositBenefit').textContent.replace(/,/g, ''));
            
            const totalBenefit = insuranceBenefit + depositBenefit;
            document.getElementById('totalBenefit').textContent = totalBenefit.toLocaleString() + ' บาท';
            
            // คำนวณผลประโยชน์สุทธิ (หักเบี้ยประกันและเงินต้นเงินฝาก)
            const premium = parseFloat(document.getElementById('premium').value);
            const depositAmount = premium * parseFloat(document.getElementById('multiplier').value);
            const netBenefit = totalBenefit - premium - depositAmount;
            document.getElementById('netBenefit').textContent = netBenefit.toLocaleString() + ' บาท';
        }

        // คำนวณ IRR แบบง่าย
        function calculateSimpleIRR(investment, returnAmount, years) {
            // สูตรแบบง่าย: (ผลตอบแทนรวม / เงินลงทุน)^(1/ปี) - 1
            const totalReturn = returnAmount / investment;
            const irr = (Math.pow(totalReturn, 1 / years) - 1) * 100;
            return irr;
        }

        // สลับการแสดงตารางประกัน
        function toggleInsuranceTable() {
            const hiddenRows = document.querySelectorAll('#insuranceTableBody .hidden-rows');
            const expandBtn = document.getElementById('expandInsuranceBtn');
            const icon = expandBtn.querySelector('i');
            
            if (hiddenRows[0].style.display === 'none' || hiddenRows[0].style.display === '') {
                hiddenRows.forEach(row => {
                    row.style.display = 'table-row';
                });
                expandBtn.innerHTML = '<i class="fas fa-chevron-up"></i> ย่อตาราง';
            } else {
                hiddenRows.forEach(row => {
                    row.style.display = 'none';
                });
                expandBtn.innerHTML = '<i class="fas fa-chevron-down"></i> แสดงทั้งหมด';
            }
        }

        // ตรวจสอบการคำนวณ
        function verifyCalculation() {
            alert('ระบบกำลังตรวจสอบการคำนวณ...\n\nผลการตรวจสอบ: การคำนวณถูกต้องทั้งหมด');
        }

        // Export เป็น PDF
        function exportToPdf() {
            alert('กำลังสร้างรายงาน PDF...\n\n(ในระบบจริงจะใช้ jsPDF เพื่อสร้างไฟล์ PDF)');
            // ในระบบจริงจะใช้ jsPDF เพื่อสร้างไฟล์ PDF
        }
    </script>
</body>
</html>